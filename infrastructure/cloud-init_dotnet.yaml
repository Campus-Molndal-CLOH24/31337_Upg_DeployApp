# cloud-config

# Install .NET Runtime 9.0 (or any other required version)
runcmd:
  # Register the Microsoft repository and install .NET Runtime 9.0
  - wget https://packages.microsoft.com/config/ubuntu/22.04/prod.list -O /etc/apt/sources.list.d/microsoft-prod.list
  - sudo apt-key adv --keyserver packages.microsoft.com --recv-keys EB3E94ADBE1229CF
  - sudo apt-get update
  - sudo apt-get install -y dotnet-runtime-9.0

# Create a service for the application
write_files:
  - path: /etc/systemd/system/GithubActionsDemo.service
    content: |
      [Unit]
      Description=ASP.NET Web App running on Ubuntu

      [Service]
      WorkingDirectory=/opt/GithubActionsDemo
      ExecStart=/usr/bin/dotnet /opt/GithubActionsDemo/GithubActionsDemo.dll
      Restart=always
      RestartSec=10
      KillSignal=SIGINT
      SyslogIdentifier=GithubActionsDemo
      User=www-data
      Environment=ASPNETCORE_ENVIRONMENT=Production
      Environment=DOTNET_PRINT_TELEMETRY_MESSAGE=false
      Environment="ASPNETCORE_URLS=http://0.0.0.0:5000"

      [Install]
      WantedBy=multi-user.target
    owner: root:root
    permissions: '0644'

systemd:
  units:
    - name: GithubActionsDemo.service
      enabled: true
